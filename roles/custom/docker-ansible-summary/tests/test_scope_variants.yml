# SPDX-FileCopyrightText: 2025 MDAD project contributors
# SPDX-License-Identifier: AGPL-3.0-or-later

---
- name: Validate scope filtering variations
  hosts: localhost
  gather_facts: true
  vars:
    docker_summary_write_facts: false
    docker_summary_enable_discovery: false
    docker_summary_container_overrides:
      - name: "Matrix-App"
        image: "example/matrix:1.0"
      - name: "matrix-sidecar"
        image: "example/sidecar:2.0"
      - name: "Mash-App"
        image: "example/mash:3.0"
  tasks:
    - name: Run DAS with mixed-case scope
      ansible.builtin.include_role:
        name: custom/docker-ansible-summary
      vars:
        docker_summary_scope:
          - "Matrix-*"
          - "matrix-sidecar"

    - name: Assert mixed-case patterns included expected services
      ansible.builtin.assert:
        that:
          - after_versions | length == 2
          - "'Matrix-App' in after_versions"
          - "'matrix-sidecar' in after_versions"
          - "'Mash-App' not in after_versions"
        fail_msg: "Scope filtering did not respect mixed patterns"

    - name: Run DAS with no-scope (all)
      ansible.builtin.include_role:
        name: custom/docker-ansible-summary
      vars:
        docker_summary_scope: []

    - name: Assert empty scope includes all containers
      ansible.builtin.assert:
        that:
          - after_versions | length == 3
        fail_msg: "Empty scope did not include all containers"
