# SPDX-FileCopyrightText: 2025 MDAD project contributors
# SPDX-License-Identifier: AGPL-3.0-or-later
# SPDX-FileCopyrightText: 2025 MDAD project contributors
# SPDX-License-Identifier: AGPL-3.0-or-later

---
- name: Exercise retention logic on BSD-like system
  hosts: localhost
  gather_facts: true
  vars:
    docker_summary_write_facts: false
    docker_summary_enable_discovery: false
    docker_summary_retention_days: 30
    docker_summary_container_overrides:
      - name: "matrix-app"
        image: "example/matrix:1.0"
  tasks:
    - name: Override ansible_system to FreeBSD for retention test
      ansible.builtin.set_fact:
        ansible_system: "FreeBSD"

    - name: Run DAS under BSD system context
      ansible.builtin.include_role:
        name: custom/docker-ansible-summary

    - name: Assert BSD retention produced cutoff date
      ansible.builtin.assert:
        that:
          - retention_cutoff_date is defined
          - retention_cutoff_date != 'null'
        fail_msg: "BSD retention did not compute a cutoff date"
