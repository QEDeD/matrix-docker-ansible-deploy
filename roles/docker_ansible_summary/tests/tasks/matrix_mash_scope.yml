---
# SPDX-FileCopyrightText: 2025 MDAD project contributors
# SPDX-License-Identifier: AGPL-3.0-or-later

- name: Override DAS scope for matrix + MASH containers
  ansible.builtin.set_fact:
    docker_ansible_summary_scope: "{{ [das_matrix_scope_pattern, das_mash_scope_pattern] }}"

- name: Summarise combined Matrix + MASH scope
  ansible.builtin.include_role:
    name: docker_ansible_summary
  vars:
    docker_ansible_summary_scope:
      - "{{ das_matrix_scope_pattern }}"
      - "{{ das_mash_scope_pattern }}"
    docker_ansible_summary_write_facts: false
    docker_ansible_summary_enable_discovery: true
    docker_ansible_summary_table_style_unicode: false
    docker_ansible_summary_ansible_local_override: {}

- name: Assert combined scope coverage
  ansible.builtin.assert:
    that:
      - (expected_names | difference(after_versions.keys() | list)) | length == 0
      - (after_versions.keys() | list | difference(expected_names)) | length == 0
  vars:
    expected_names: "{{ (das_matrix_containers + das_mash_containers) | map(attribute='name') | list }}"
    fail_msg: "Combined scope should contain all remaining matrix-* and mash-* containers"
