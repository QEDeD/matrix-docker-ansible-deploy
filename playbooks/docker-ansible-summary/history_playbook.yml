# SPDX-FileCopyrightText: 2025 MDAD project contributors
# SPDX-License-Identifier: AGPL-3.0-or-later

---
# Docker Service Version History viewing playbook
- name: View Docker Service Version History
  hosts: "{{ target_host | default(docker_summary_target_host | default('matrix_servers')) }}"
  gather_facts: true
  vars:
    summary_history_fact_file: "{{ docker_summary_history_fact_file | default('matrix_version_history.fact') }}"
    summary_table_style_unicode: "{{ docker_summary_table_style_unicode | default(true) }}"
  tasks:
    - name: Validate view mode
      ansible.builtin.fail:
        msg: "Invalid view_mode '{{ view_mode }}'. Valid options are 'changes' or 'full'."
      when: view_mode not in ['changes', 'full']

    - name: Check if history file exists
      ansible.builtin.stat:
        path: "/etc/ansible/facts.d/{{ summary_history_fact_file }}"
      register: history_file

    - name: Warn if history file missing
      ansible.builtin.debug:
        msg: "Warning: No history file found at /etc/ansible/facts.d/{{ summary_history_fact_file }}. You may not see any results."
      when: not history_file.stat.exists

    - name: Include version history display task
      ansible.builtin.include_tasks: ../../roles/custom/docker-ansible-summary/tasks/view_history.yml
